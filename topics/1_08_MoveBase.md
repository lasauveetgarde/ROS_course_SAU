# Заголовок

- [Состав move_base](#состав-move_base)
- [Карты стоимостей](#карты-стоимостей)
- [Планнер](#планнер)
- [Чему научились?](#чему-научились)
- [Задание](#задание)
- [Вопросики](#вопросики)
- [Ресурсы](#ресурсы)



## Состав move_base

Стек навигации включает в себя множество пакетов для решения целей навигации: планировщики, работа с картами, локализация. Каждый узел существует незавсимо и может быть написан вручную или найден на просторах GitHub. Для объединения всего этого добра в ROS существует узел move_base. На картинке ниже показана схема работы узла move_base и его взаимодействия с другими компонентами. Синие узлы различаются в зависимости от платформы робота, серые являются необязательными, а белые узлы являются обязательными. На первый взгляд схема может показаться запутанной, но по мере изучения отдельных узлов навигации рекомендуется к ней возвращаться, и рано или поздно всё встанет на свои места =)


<p align="center">
<img src=../assets/01_08_overview_move_base.png width=900/>
</p>

Сам узел move_base находится в черном квадрате посередине и включает две большие задачи: построение карты стоимостей и планирование маршрутов.

> Во многих пакетах ROS встречается разделение на global и local. Local обычно привязывается к системе координат движущегося робота, а global к неподвижной системе координат карты. 

Начнем разбиратся по порядку.

## Карты стоимостей

Для того чтобы начать какое-либо движение, необходимо понимать вид окружающей среды: где можно ездить, а где нельзя. move_base преобразует данные бортовых датчиков (камеры, лидары и т.п) и предзаписанных карт в формат costmap.  Основной формат внутреннеого представление карт в ROS носит название OccupancyGrid, где пространтсво вокруг робота разбивается на клетки заданного размера. У каждой клетки есть значение "occ", которое отражает вероятность занятости клетки в процентах. В простейшем случае есть 3 вида клеток:
- свободная область: occ = 0
- занятая область: occ = 100
- неизвестная область: occ = -1

Обычно используется следующий подход: в global costmap отправляется карта всей местности (план этажа, квартиры, завода), а в local costmap отправляются данные лазерных лидаров и камер, которые помогут учитывать препятсвия возникающие перед роботом.

:octocat: TODO
Написать как у нас сейчас запускается тартлбот, я не читал...

Для того чтобы увидить отличие на примере запустим нашего тартлбота переходим в меню выбора отображения (`Add`->`By topic`), выбираем путь `move_base/global_costmap/costmap` и там выбираем Map. Перед тем, как окончательно выбрать, внизу в Display Name наберите "Global Map". Аналогично добавляем local_costmap. Должно получиться что-то вроде этого, где цветным показанна локальная карта стоимостей, а в оттенках серого - глобальная.

<p align="center">
<img src=../assets/01_09_costmaps.png width=500/>
</p>

> Для смены режима отображения карты, в меню Displays нажимаем на локальную карту и в выпадающем меню в разделе Color Scheme выбираем "`costmap`" 

:octocat: TODO
Написать как у нас сейчас запускается тартлбот, я не читал...

## Планнер

После создание карты, переходим к планированию движения. Если для карт стоимостей подход создания локальной и глобальной карты идентичен, то у планировщиков всё немного сложнее. Глобальный и локальный планнеры выполняют разные задачи и реализуются разными пакетами. Алгоритм следующий: 
1) Global Planner, используя global costmap, строит кратчайший путь к цели.
2) Local Planner следует глобальному пути, но учитывает возникающие препятсвия и габариты робота.

Работу планнеро так же можно увидеть в Rviz, для этого переходим в меню выбора отображения (`Add`->`By topic`), выбираем путь `move_base/NavfnROS/plan` и там выбираем Path (зеленая линия). Перед тем, как окончательно выбрать, внизу в Display Name наберите "Global Path". Аналогично добавьте "Local Path". 

> :muscle: Попробуйте позадавать цели и посмотреть на работу локального и глобального планнера. На сколько далеко строится маршрут? По какому принципу строится локальная и глобальная траектория?

:octocat: TODO
В целом это уже было в уроке по тартлботу, я хз че тут можно добавить.

## Чему научились?

TODO

## Задание

> :muscle: Текст задачки
> 
> =)

## Вопросики

TODO

## Ресурсы